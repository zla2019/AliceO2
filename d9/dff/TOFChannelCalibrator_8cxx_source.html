<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: /home/travis/build/AliceO2Group/AliceO2/Detectors/TOF/calibration/src/TOFChannelCalibrator.cxx Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d9/dff/TOFChannelCalibrator_8cxx_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TOFChannelCalibrator.cxx</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/dff/TOFChannelCalibrator_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright CERN and copyright holders of ALICE O2. This software is</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// distributed under the terms of the GNU General Public License v3 (GPL</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Version 3), copied verbatim in the file &quot;COPYING&quot;.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See http://alice-o2.web.cern.ch/license for full licensing information.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// In applying this license CERN does not waive the privileges and immunities</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// granted to it by virtue of its status as an Intergovernmental Organization</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// or submit itself to any jurisdiction.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dc2/TOFChannelCalibrator_8h.html">TOFCalibration/TOFChannelCalibrator.h</a>&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/da4/Logger_8h.html">Framework/Logger.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d72/MathBase_8h.html">MathUtils/MathBase.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/db7/MemFileHelper_8h.html">CommonUtils/MemFileHelper.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d3e/CcdbApi_8h.html">CCDB/CcdbApi.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/de0/Detectors_2Calibration_2include_2DetectorsCalibration_2Utils_8h.html">DetectorsCalibration/Utils.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;boost/histogram.hpp&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;boost/histogram/ostream.hpp&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;boost/format.hpp&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;TStopwatch.h&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">namespace </span><a class="code" href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">namespace </span>tof</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d7/dae/namespaceo2_1_1tof.html#a2c22977d7d687ce24d27d3bbbebd3848">Slot</a> = <a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">o2::calibration::TimeSlot&lt;o2::tof::TOFChannelData&gt;</a>;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="../../d7/dae/namespaceo2_1_1tof.html#a3973e777d569ad62c68b4d7dcbbb657d">   31</a></span>&#160;<span class="keyword">using</span> <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">TimeSlewing</a> = <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">o2::dataformats::CalibTimeSlewingParamTOF</a>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d1/d7c/structo2_1_1calibration_1_1Utils.html">clbUtils</a> = <a class="code" href="../../d1/d7c/structo2_1_1calibration_1_1Utils.html">o2::calibration::Utils</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">using</span> boost::histogram::indexed;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d6/db0/namespaceo2_1_1math__utils_1_1math__base.html#a4d51272e915c57fb54bb05565cddbdc7">o2::math_utils::math_base::fitGaus</a>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//using boost::histogram::algorithm; // not sure why it does not work...</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">TOFChannelData::fill</a>(<span class="keyword">const</span> gsl::span&lt;const o2::dataformats::CalibInfoTOF&gt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a>)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// fill container</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = data.size(); <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--;) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keyword">auto</span> ch = data[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getTOFChIndex();</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">int</span> sector = ch / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">int</span> chInSect = ch % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keyword">auto</span> dt = data[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getDeltaTimePi();</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">auto</span> tot = data[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getTot();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// TO BE DISCUSSED: could it be that the LHCphase is too old? If we ar ein sync mode, it could be that it is not yet created for the current run, so the one from the previous run (which could be very old) is used. But maybe it does not matter much, since soon enough a calibrated LHC phase should be produced</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keyword">auto</span> corr = mCalibTOFapi-&gt;<a class="code" href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">getTimeCalibration</a>(ch, tot); <span class="comment">// we take into account LHCphase, offsets and time slewing</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;inserting in channel &quot;</span> &lt;&lt; ch &lt;&lt; <span class="stringliteral">&quot;: dt = &quot;</span> &lt;&lt; dt &lt;&lt; <span class="stringliteral">&quot;, tot = &quot;</span> &lt;&lt; tot &lt;&lt; <span class="stringliteral">&quot;, corr = &quot;</span> &lt;&lt; corr &lt;&lt; <span class="stringliteral">&quot;, corrected dt = &quot;</span> &lt;&lt; dt - corr;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    mHisto[sector](dt - corr, chInSect); <span class="comment">// we pass the calibrated time</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    mEntries[ch] += 1;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ae6857148899e64edd5017e78eea7c0ca">   56</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ae6857148899e64edd5017e78eea7c0ca">TOFChannelData::merge</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">TOFChannelData</a>* prev)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">// merge data of 2 slots</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isect = 0; isect &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">o2::tof::Geo::NSECTORS</a>; isect++) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    mHisto[isect] += prev-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a1777d0fe702c095d9819568246bc63cf">getHisto</a>(isect);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">   65</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">TOFChannelData::hasEnoughData</a>(<span class="keywordtype">int</span> minEntries)<span class="keyword"> const</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// true if all channels can be fitted --&gt; have enough statistics</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// TODO: think of a better logic: it could be that some channels are off or misbehaving and do not</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// have enough entries, even if in principle we collected enough</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// we can simply check if the min of the elements of the mEntries vector is &gt;= minEntries</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">printEntries</a>();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keyword">auto</span> minElementIndex = std::min_element(mEntries.begin(), mEntries.end());</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;minElement is at position &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a744fbed01658cb96bb8ba7e85a86d1dc">std::distance</a>(mEntries.begin(), minElementIndex) &lt;&lt; <span class="stringliteral">&quot; and is &quot;</span> &lt;&lt; *minElementIndex;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordtype">bool</span> enough = *minElementIndex &lt; minEntries ? <a class="code" href="../../d8/de9/qconfigoptions_8h.html#a0c118737149aef562beb4d2d909b7856">false</a> : <span class="keyword">true</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;hasEnough = &quot;</span> &lt;&lt; (<a class="code" href="../../d8/de9/qconfigoptions_8h.html#a0cef832a4f8154f4d66208d6d43cde29">int</a>)enough;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">return</span> enough;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">   82</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">TOFChannelData::print</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Printing histograms:&quot;</span>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isect = 0; isect &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">o2::tof::Geo::NSECTORS</a>; isect++) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Sector: &quot;</span> &lt;&lt; isect;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    os &lt;&lt; mHisto[isect];</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">auto</span> nentriesInSec = boost::histogram::algorithm::sum(mHisto[isect]);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Number of entries in histogram: &quot;</span> &lt;&lt; boost::histogram::algorithm::sum(mHisto[isect]);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordtype">int</span> cnt = 0;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (nentriesInSec != 0) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> : indexed(mHisto[isect])) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get() &gt; 0) {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.index(0); <span class="comment">// current index along first axis --&gt; t-texp</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> j = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.index(1); <span class="comment">// current index along second axis --&gt; channel</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> b0 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.bin(0);  <span class="comment">// current bin interval along first axis --&gt; t-texp</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> b1 = <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.bin(1);  <span class="comment">// current bin interval along second axis --&gt; channel</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;          <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;bin &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot;: channel = &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot; in [&quot;</span> &lt;&lt; b1.lower() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; b1.upper()</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;], t-texp in [&quot;</span> &lt;&lt; b0.lower() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; b0.upper() &lt;&lt; <span class="stringliteral">&quot;], has entries = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        cnt++;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; bins inspected&quot;</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ad1978708df097963b60d9ae805056522">  110</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">TOFChannelData::print</a>(<span class="keywordtype">int</span> isect)<span class="keyword"> const</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;*** Printing histogram &quot;</span> &lt;&lt; isect;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">int</span> cnt = 0;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  os &lt;&lt; mHisto[isect];</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Number of entries in histogram: &quot;</span> &lt;&lt; boost::histogram::algorithm::sum(mHisto[isect]);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> : indexed(mHisto[isect])) { <span class="comment">// does not work also when I use indexed(*(mHisto[sector]))</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    cnt++;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">//LOG(INFO) &lt;&lt; &quot; c &quot; &lt;&lt; cnt &lt;&lt; &quot; i &quot; &lt;&lt; x.index(0) &lt;&lt; &quot; j &quot; &lt;&lt; x.index(1) &lt;&lt; &quot; b0 &quot; &lt;&lt;  x.bin(0) &lt;&lt;  &quot; b1 &quot; &lt;&lt;  x.bin(1) &lt;&lt; &quot; val= &quot; &lt;&lt; *x &lt;&lt; &quot;|&quot; &lt;&lt; x.get();</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get() &gt; 0) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;x = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>.get() &lt;&lt; <span class="stringliteral">&quot; c &quot;</span> &lt;&lt; cnt;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot; bins inspected&quot;</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;}</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">  128</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">TOFChannelData::printEntries</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// to print number of entries per channel</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mEntries.size(); ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;channel &quot;</span> &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; has &quot;</span> &lt;&lt; mEntries[<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; entries&quot;</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">  136</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">TOFChannelData::findBin</a>(<span class="keywordtype">float</span> <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// find the bin along the x-axis (with t-texp) where the value &quot;v&quot; is; this does not depend on the channel</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// (axis 1), nor on the sector, so we use sector0</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> (v == mRange)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    v -= 1.e-1;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;In FindBin, v = : &quot; &lt;&lt; v;</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;bin0 limits: lower = &quot; &lt;&lt; mHisto[0].axis(0).bin(0).lower() &lt;&lt; &quot;, upper = &quot; &lt;&lt; mHisto[0].axis(0).bin(0).upper();</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;bin1000 limits: lower = &quot; &lt;&lt; mHisto[0].axis(0).bin(mNBins-1).lower() &lt;&lt; &quot;, upper = &quot; &lt;&lt; mHisto[0].axis(0).bin(mNBins-1).upper();</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;v = &quot; &lt;&lt; v &lt;&lt; &quot; is in bin &quot; &lt;&lt; mHisto[0].axis(0).index(v);</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">return</span> mHisto[0].axis(0).index(v);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">  154</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> chmin, <span class="keywordtype">int</span> chmax, <span class="keywordtype">float</span> binmin, <span class="keywordtype">float</span> binmax)<span class="keyword"> const</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// calculates the integral in [chmin, chmax] and in [binmin, binmax]</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">if</span> (binmin &lt; -mRange || binmax &gt; mRange || chmin &lt; 0 || chmax &gt;= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#ab8ab3733fc270083bb053f638332c733">o2::tof::Geo::NCHANNELS</a>)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Check your bins, we cannot calculate the integrals in under/overflows bins&quot;</span>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">if</span> (binmax &lt; binmin || chmax &lt; chmin)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Check your bin limits!&quot;</span>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">int</span> sector = chmin / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (sector != chmax / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;We cannot integrate over channels that belong to different sectors&quot;</span>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">int</span> chinsectormin = chmin % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">int</span> chinsectormax = chmax % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">//LOG(INFO) &lt;&lt; &quot;Calculating integral for channel &quot; &lt;&lt; ich &lt;&lt; &quot; which is in sector &quot; &lt;&lt; sector</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">//      &lt;&lt; &quot; (channel in sector is &quot; &lt;&lt; chinsector &lt;&lt; &quot;)&quot;;;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">//  LOG(INFO) &lt;&lt; &quot;Bin min = &quot; &lt;&lt; binmin &lt;&lt; &quot;, binmax = &quot; &lt;&lt; binmax &lt;&lt;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">//             &quot;, chmin = &quot; &lt;&lt; chmin &lt;&lt; &quot;, chmax = &quot; &lt;&lt; chmax &lt;&lt;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">//             &quot;, chinsectormin = &quot; &lt;&lt; chinsectormin &lt;&lt; &quot;, chinsector max = &quot; &lt;&lt; chinsectormax;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">float</span> res2 = 0;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  TStopwatch t3;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">int</span> ind = -1;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">int</span> binxmin = <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">findBin</a>(binmin);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">int</span> binxmax = <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">findBin</a>(binmax);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;binxmin = &quot;</span> &lt;&lt; binxmin &lt;&lt; <span class="stringliteral">&quot;, binxmax = &quot;</span> &lt;&lt; binxmax;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  t3.Start();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = chinsectormin; j &lt;= chinsectormax; ++j) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = binxmin; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= binxmax; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = mHisto[sector].at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      res2 += <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  t3.Stop();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Time for integral looping over axis (result = &quot;</span> &lt;&lt; res2 &lt;&lt; <span class="stringliteral">&quot;):&quot;</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  t3.Print();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">return</span> res2;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">/* // what is below is only for alternative methods which all proved to be slower</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">  float res = 0, res1 = 0;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">  TStopwatch t1, t2, </span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">  int startCount = chinsectormin * mNBins + binxmin;</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">  int endCount =  chinsectormax * mNBins + binxmax; // = startCount + (chinsectormax - chinsectormin) * mNBins + (binxmax - binxmin);</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">  LOG(DEBUG) &lt;&lt; &quot;startCount = &quot; &lt;&lt; startCount &lt;&lt; &quot; endCount = &quot; &lt;&lt; endCount-1;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">  t2.Start();</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">  int counts = -1;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">  for (auto&amp;&amp; x : indexed(mHisto[sector])) {</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    counts++;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">    if (counts &lt; startCount) continue;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">    if (x.bin(0).lower() &gt; binmax &amp;&amp; chinsectormin == chinsectormax) { // all others also will be &gt; but only if chmin = chmax; in the other cases, we should jump to the next row,which for now we cannot do in boost</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">      //      LOG(INFO) &lt;&lt; &quot;x.bin(0).lower() &gt; binmax &amp;&amp; chinsectormin == chinsectormax: BREAKING&quot;;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">      break;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">    if (x.index(1) &gt; chinsectormax) { // we passed the needed channel</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">      //LOG(INFO) &lt;&lt; &quot;x.index(1) &gt; chinsectormax: BREAKING&quot;;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">      break;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">    if ( (x.bin(0).upper() &gt; binmin) &amp;&amp; (x.bin(0).lower() &lt;= binmax) &amp;&amp; (x.index(1) &gt;= chinsectormin)) { // I have to keep the condition &quot;&amp;&amp; (x.bin(0).lower() &lt;= binmax)&quot; because I can break only if chmin == chmax</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">      res1 += x.get();</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">      //if (x.get() != 0) LOG(INFO) &lt;&lt; &quot;ind = &quot; &lt;&lt; counts &lt;&lt; &quot; will add bin &quot; &lt;&lt; x.index(0)</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">      //          &lt;&lt; &quot; along x (in [&quot; &lt;&lt; x.bin(0).lower() &lt;&lt; &quot;, &quot;</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">      //          &lt;&lt; x.bin(0).upper() &lt;&lt; &quot;], and bin &quot; &lt;&lt; x.index(1) &lt;&lt; &quot; along y&quot; &lt;&lt; &quot; with content &quot; &lt;&lt; x.get() &lt;&lt; &quot; --&gt; res1 = &quot; &lt;&lt; res1;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">  t2.Stop();</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for integral looping over restricted range (result = &quot; &lt;&lt; res1 &lt;&lt; &quot;):&quot;;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">  t2.Print();</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">  t1.Start();</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">  ind = -1;</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">  for (auto&amp;&amp; x : indexed(mHisto[sector])) { </span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">    ind++;</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">    if ((x.bin(0).upper() &gt; binmin &amp;&amp; x.bin(0).lower() &lt; binmax) &amp;&amp; (x.index(1) &gt;= chinsectormin &amp;&amp; x.index(1) &lt;= chinsectormax)) {</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">      res += x.get();</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">      //if (x.get() != 0) LOG(INFO) &lt;&lt; &quot;ind = &quot; &lt;&lt; ind &lt;&lt; &quot; will add bin &quot; &lt;&lt; x.index(0)</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">      //          &lt;&lt; &quot; along x (in [&quot; &lt;&lt; x.bin(0).lower() &lt;&lt; &quot;, &quot;</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">      //        &lt;&lt; x.bin(0).upper() &lt;&lt; &quot;], and bin &quot; &lt;&lt; x.index(1) &lt;&lt; &quot; along y&quot; &lt;&lt; &quot; with content &quot; &lt;&lt; x.get();</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">  t1.Stop();</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for integral looping (result = &quot; &lt;&lt; res &lt;&lt; &quot;):&quot;;</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">  t1.Print();</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Reducing... &quot;;</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">  TStopwatch t;</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">  t.Start();</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">  if (binmin == binmax) binmax += 1.e-1;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">  float chinsectorminfl = float(chinsectormin);</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">  float chinsectormaxfl = float(chinsectormax);</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">  chinsectormaxfl += 1.e-1; // we need to add a bit because the upper value otherwise is not included</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">  LOG(DEBUG) &lt;&lt; &quot;chinsectorminfl = &quot; &lt;&lt; chinsectorminfl &lt;&lt; &quot;, chinsectormaxfl = &quot; &lt;&lt; chinsectormaxfl &lt;&lt; &quot;, binmin= &quot; &lt;&lt; binmin &lt;&lt; &quot;, binmax = &quot; &lt;&lt; binmax;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">  LOG(DEBUG) &lt;&lt; &quot;chinsectormin = &quot; &lt;&lt; chinsectormin &lt;&lt; &quot;, chinsectormax = &quot; &lt;&lt; chinsectormax;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">  auto hch = boost::histogram::algorithm::reduce(mHisto[sector],</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">               boost::histogram::algorithm::shrink(1, chinsectorminfl, chinsectormaxfl),</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">               boost::histogram::algorithm::shrink(0, binmin, binmax)); </span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  t.Stop();</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for projection with shrink&quot;;</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  t.Print();</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;...done.&quot;;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">  </span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">  //int sizeBeforeAxis1 = mHisto[sector].axis(1).size();</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">  //int sizeAfterAxis1 = hch.axis(1).size();</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">  //int sizeBeforeAxis0 = mHisto[sector].axis(0).size();</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">  //int sizeAfterAxis0 = hch.axis(0).size();</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">  //std::cout &lt;&lt; &quot;axis size before reduction: axis 0: &quot; &lt;&lt; sizeBeforeAxis0 &lt;&lt; &quot;, axis 1: &quot; &lt;&lt; sizeBeforeAxis1 &lt;&lt; std::endl;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  //std::cout &lt;&lt; &quot;axis size after reduction:  axis 0: &quot; &lt;&lt; sizeAfterAxis0 &lt;&lt; &quot;, axis 1: &quot; &lt;&lt; sizeAfterAxis1 &lt;&lt; std::endl;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">  </span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">  t.Start();</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">  auto indhch = indexed(hch);</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">  const double enthchInd = std::accumulate(indhch.begin(), indhch.end(), 0.0); </span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">  t.Stop();</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for accumulate (result = &quot; &lt;&lt; enthchInd &lt;&lt; &quot;)&quot;;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">  t.Print();</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">  return enthchInd;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ab54e9116e5ad021b0a607dae077ccc72">  273</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> ch, <span class="keywordtype">float</span> binmin, <span class="keywordtype">float</span> binmax)<span class="keyword"> const</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">// calculates the integral along one fixed channel and in [binmin, binmax]</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ch, ch, binmin, binmax);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a77bc188925de89b48ee9b7b0e807b31e">  281</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> chmin, <span class="keywordtype">int</span> chmax, <span class="keywordtype">int</span> binxmin, <span class="keywordtype">int</span> binxmax)<span class="keyword"> const</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// calculates the integral in [chmin, chmax] and in [binmin, binmax]</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span> (binxmin &lt; 0 || binxmax &gt; mNBins || chmin &lt; 0 || chmax &gt;= <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#ab8ab3733fc270083bb053f638332c733">o2::tof::Geo::NCHANNELS</a>)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Check your bins, we cannot calculate the integrals in under/overflows bins&quot;</span>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">if</span> (binxmax &lt; binxmin || chmax &lt; chmin)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Check your bin limits!&quot;</span>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">int</span> sector = chmin / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (sector != chmax / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;We cannot integrate over channels that belong to different sectors&quot;</span>);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">int</span> chinsectormin = chmin % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordtype">int</span> chinsectormax = chmax % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">//LOG(INFO) &lt;&lt; &quot;Calculating integral for channel &quot; &lt;&lt; ich &lt;&lt; &quot; which is in sector &quot; &lt;&lt; sector</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">//      &lt;&lt; &quot; (channel in sector is &quot; &lt;&lt; chinsector &lt;&lt; &quot;)&quot;;;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">//LOG(INFO) &lt;&lt; &quot;Bin min = &quot; &lt;&lt; binmin &lt;&lt; &quot;, binmax = &quot; &lt;&lt; binmax &lt;&lt;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">//             &quot;, chmin = &quot; &lt;&lt; chmin &lt;&lt; &quot;, chmax&quot; &lt;&lt; chmax &lt;&lt;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">//             &quot;, chinsectormin = &quot; &lt;&lt; chinsector min &lt;&lt; &quot;, chinsector max = &quot; &lt;&lt; chinsectormax;</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">float</span> res2 = 0;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  TStopwatch t3;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  t3.Start();</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = chinsectormin; j &lt;= chinsectormax; ++j) {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = binxmin; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= binxmax; ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = mHisto[sector].at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      res2 += <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  t3.Stop();</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Time for integral looping over axis (result = &quot;</span> &lt;&lt; res2 &lt;&lt; <span class="stringliteral">&quot;):&quot;</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  t3.Print();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">return</span> res2;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">/* // all that is below is alternative methods, all proved to be slower</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">  float res = 0, res1 = 0;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">  TStopwatch t1, t2;</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">  int ind = -1;</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">  int startCount = chinsectormin * mNBins + binxmin;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">  int endCount =  chinsectormax * mNBins + binxmax; // = startCount + (chinsectormax - chinsectormin) * mNBins + (binxmax - binxmin);</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">  LOG(DEBUG) &lt;&lt; &quot;startCount = &quot; &lt;&lt; startCount &lt;&lt; &quot; endCount = &quot; &lt;&lt; endCount-1;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">  t2.Start();</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">  int counts = -1;</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">  for (auto&amp;&amp; x : indexed(mHisto[sector])) {</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">    counts++;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">    if (counts &lt; startCount) continue;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">    if (x.index(0) &gt; binxmax &amp;&amp; chinsectormin == chinsectormax) { // all others also will be &gt; but only if chmin = chmax; in the other cases, we should jump to the next row,which for now we cannot do in boost</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">      //LOG(INFO) &lt;&lt; &quot;x.index(0) &gt; binxmax &amp;&amp; chinsectormin == chinsectormax: BREAKING&quot;;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">      break;</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">    if (x.index(1) &gt; chinsectormax) { // we passed the needed channel</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">      //LOG(INFO) &lt;&lt; &quot;x.index(1) &gt; chinsectormax) &gt; chinsectormax: BREAKING&quot;;</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">      break;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">    if ( (x.index(0) &gt;= binxmin) &amp;&amp; (x.index(0) &lt;= binxmax) &amp;&amp; (x.index(1) &gt;= chinsectormin)) { // I have to keep the condition &quot;&amp;&amp; (x.bin(0).lower() &lt;= binmax)&quot; because I can break only if chmin == chmax</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">  res1 += x.get();</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">  //  if (x.get() != 0) </span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">  // LOG(INFO) &lt;&lt; &quot;ind = &quot; &lt;&lt; counts &lt;&lt; &quot; will add bin &quot; &lt;&lt; x.index(0)</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">  //      &lt;&lt; &quot; along x (in [&quot; &lt;&lt; x.bin(0).lower() &lt;&lt; &quot;, &quot;</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">  //      &lt;&lt; x.bin(0).upper() &lt;&lt; &quot;], and bin &quot; &lt;&lt; x.index(1) &lt;&lt; &quot; along y&quot; &lt;&lt; &quot; with content &quot; &lt;&lt; x.get()</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">  //      &lt;&lt; &quot; --&gt; res1 = &quot; &lt;&lt; res1;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">  t2.Stop();</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for integral looping over restricted range (result = &quot; &lt;&lt; res1 &lt;&lt; &quot;):&quot;;</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">  t2.Print();</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">  t1.Start();</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">  for (auto&amp;&amp; x : indexed(mHisto[sector])) { </span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">    ind++;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">    if ((x.index(0) &gt;= binxmin &amp;&amp; x.index(0) &lt;= binxmax) &amp;&amp; (x.index(1) &gt;= chinsectormin &amp;&amp; x.index(1) &lt;= chinsectormax)) {</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">      res += x.get();</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">      //LOG(INFO) &lt;&lt; &quot;ind = &quot; &lt;&lt; ind &lt;&lt; &quot; will add bin &quot; &lt;&lt; x.index(0) &lt;&lt; &quot; along x and bin &quot; &lt;&lt; x.index(1) &lt;&lt; &quot; along y&quot;;</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">  t1.Stop();</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for integral looping (result = &quot; &lt;&lt; res &lt;&lt; &quot;):&quot;;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">  t1.Print();</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Reducing... &quot;;</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">  TStopwatch t;</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">  t.Start();</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">  auto hch = boost::histogram::algorithm::reduce(mHisto[sector],</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">               boost::histogram::algorithm::slice(1, chinsectormin, chinsectormax+1),</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">               boost::histogram::algorithm::slice(0, binxmin, binxmax+1)); // we need to add &quot;+1&quot; </span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">  t.Stop();</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for projection with slice&quot;;</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">  t.Print();</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">  //LOG(INFO) &lt;&lt; &quot;...done.&quot;;</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">  //int sizeBeforeAxis1 = mHisto[sector].axis(1).size();</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">  //int sizeAfterAxis1 = hch.axis(1).size();</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">  //int sizeBeforeAxis0 = mHisto[sector].axis(0).size();</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">  //int sizeAfterAxis0 = hch.axis(0).size();</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">  //std::cout &lt;&lt; &quot;axis size before reduction: axis 0: &quot; &lt;&lt; sizeBeforeAxis0 &lt;&lt; &quot;, axis 1: &quot; &lt;&lt; sizeBeforeAxis1 &lt;&lt; std::endl;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">  //std::cout &lt;&lt; &quot;axis size after reduction:  axis 0: &quot; &lt;&lt; sizeAfterAxis0 &lt;&lt; &quot;, axis 1: &quot; &lt;&lt; sizeAfterAxis1 &lt;&lt; std::endl;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">  </span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">  // first way: using indexed (which excludes under/overflow)</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">  t.Start();</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">  auto indhch = indexed(hch);</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">  const double enthchInd = std::accumulate(indhch.begin(), indhch.end(), 0.0); </span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">  t.Stop();</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">  LOG(INFO) &lt;&lt; &quot;Time for accumulate (result = &quot; &lt;&lt; enthchInd &lt;&lt; &quot;)&quot;;</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">  t.Print();</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">  return enthchInd;</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a9ae346a1679b7e611ddbeb5872c55ef3">  388</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> ch, <span class="keywordtype">int</span> binxmin, <span class="keywordtype">int</span> binxmax)<span class="keyword"> const</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">// calculates the integral along one fixed channel and in [binmin, binmax]</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ch, ch, binxmin, binxmax);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a7c50332d0130cb6aeda3e6358146fbe6">  396</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">TOFChannelData::integral</a>(<span class="keywordtype">int</span> ch)<span class="keyword"> const</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// calculates the integral along one fixed channel and in the full x-range</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ch, ch, 0, mNBins - 1);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">//===================================================================</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00406"></a><span class="lineno"><a class="line" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a206906f9633f12c46293a6848eedc664">  406</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a206906f9633f12c46293a6848eedc664">TOFChannelCalibrator::initOutput</a>()</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;{</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">// Here we initialize the vector of our output objects</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  mInfoVector.clear();</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  mTimeSlewingVector.clear();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a8b5f97f720904a0661302a57dfdb5ac6">  415</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a8b5f97f720904a0661302a57dfdb5ac6">TOFChannelCalibrator::hasEnoughData</a>(<span class="keyword">const</span> <a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">Slot</a>&amp; slot)<span class="keyword"> const</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">// Checking if all channels have enough data to do calibration.</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// Delegating this to TOFChannelData</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">o2::tof::TOFChannelData</a>* c = slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a6d93b6aefa753710338dc444293e2f69">getContainer</a>();</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Checking statistics&quot;</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">return</span> (mTest ? <span class="keyword">true</span> : c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">hasEnoughData</a>(mMinEntries));</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00427"></a><span class="lineno"><a class="line" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#ad76753b4f6bf5d2abca3cd895d069b4e">  427</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#ad76753b4f6bf5d2abca3cd895d069b4e">TOFChannelCalibrator::finalizeSlot</a>(<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">Slot</a>&amp; slot)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;{</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// Extract results for the single slot</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">o2::tof::TOFChannelData</a>* c = slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a6d93b6aefa753710338dc444293e2f69">getContainer</a>();</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(INFO) &lt;&lt; <span class="stringliteral">&quot;Finalize slot &quot;</span> &lt;&lt; slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">getTFStart</a>() &lt;&lt; <span class="stringliteral">&quot; &lt;= TF &lt;= &quot;</span> &lt;&lt; slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a1477ee455be0381a720a32610a5a87d7">getTFEnd</a>();</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// for the CCDB entry</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  std::map&lt;std::string, std::string&gt; md;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">TimeSlewing</a>&amp; ts = mCalibTOFapi-&gt;<a class="code" href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a07438f80c9ce46ef6adc737873574f00">getSlewParamObj</a>(); <span class="comment">// we take the current CCDB object, since we want to simply update the offset</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ich = 0; ich &lt; <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#ab8ab3733fc270083bb053f638332c733">o2::tof::Geo::NCHANNELS</a>; ich++) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// make the slice of the 2D histogram so that we have the 1D of the current channel</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordtype">int</span> sector = ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">int</span> chinsector = ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    std::vector&lt;float&gt; fitValues;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    std::vector&lt;float&gt; histoValues;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">/* //less efficient way</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">    int startCount = chinsector * c-&gt;getNbins();</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">    int counts = -1;</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">    for (auto&amp;&amp; x : indexed(c-&gt;getHisto(sector))) {</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">      counts++;</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">      if (counts &lt; startCount) continue;</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">      if (x.index(1) &gt; chinsector) { // we passed the needed channel</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">  //LOG(INFO) &lt;&lt; &quot;x.index(1) &gt; chinsectormax) &gt; chinsectormax: BREAKING&quot;;</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">  break;</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">      histoValues.push_back(x.get());</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    std::vector&lt;int&gt; entriesPerChannel = c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a24a30678d517ad6e453258b9c3268b5f">getEntriesPerChannel</a>();</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (entriesPerChannel.at(ich) == 0) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">if</span> (mTest) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Skipping channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; because it has zero entries, but it should not be&quot;</span>; <span class="comment">// should become error!</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;We found one channel with no entries, we cannot calibrate!&quot;</span>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// more efficient way</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keyword">auto</span> histo = c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a1777d0fe702c095d9819568246bc63cf">getHisto</a>(sector);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = chinsector; j &lt;= chinsector; ++j) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a274f94da58c355e71c0130ce3da3a538">getNbins</a>(); ++<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a> = histo.at(<a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;channel = &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot;, in sector = &quot;</span> &lt;&lt; sector &lt;&lt; <span class="stringliteral">&quot; (where it is channel = &quot;</span> &lt;&lt; chinsector &lt;&lt; <span class="stringliteral">&quot;) bin = &quot;</span> &lt;&lt; <a class="code" href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; value = &quot;</span> &lt;&lt; <a class="code" href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        histoValues.push_back(v);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">int</span> fitres = <a class="code" href="../../d6/db0/namespaceo2_1_1math__utils_1_1math__base.html#a4d51272e915c57fb54bb05565cddbdc7">fitGaus</a>(c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a274f94da58c355e71c0130ce3da3a538">getNbins</a>(), histoValues.data(), -(c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a4e1bc930065ae1e1d544f84aaec652d8">getRange</a>()), c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a4e1bc930065ae1e1d544f84aaec652d8">getRange</a>(), fitValues);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (fitres &gt;= 0) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(DEBUG) &lt;&lt; <span class="stringliteral">&quot;Channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; :: Fit result &quot;</span> &lt;&lt; fitres &lt;&lt; <span class="stringliteral">&quot; Mean = &quot;</span> &lt;&lt; fitValues[1] &lt;&lt; <span class="stringliteral">&quot; Sigma = &quot;</span> &lt;&lt; fitValues[2];</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <a class="code" href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a>(<a class="code" href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">ERROR</a>) &lt;&lt; <span class="stringliteral">&quot;Channel &quot;</span> &lt;&lt; ich &lt;&lt; <span class="stringliteral">&quot; :: Fit failed with result = &quot;</span> &lt;&lt; fitres;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">float</span> fractionUnderPeak;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">float</span> intmin = fitValues[1] - 5 * fitValues[2]; <span class="comment">// mean - 5*sigma</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordtype">float</span> intmax = fitValues[1] + 5 * fitValues[2]; <span class="comment">// mean + 5*sigma</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">/* </span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">    // needed if we calculate the integral using the values</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">    int binmin = c-&gt;findBin(intmin);</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">    int binmax = c-&gt;findBin(intmax);</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">    // for now these checks are useless, as we pass the value of the bin</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">    if (binmin &lt; 0)</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">      binmin = 1; // avoid to take the underflow bin (can happen in case the sigma is too large)</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">    if (binmax &gt;= c-&gt;getNbins())</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">      binmax = c-&gt;getNbins()-1; // avoid to take the overflow bin (can happen in case the sigma is too large)</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">    float fractionUnderPeak = (c-&gt;integral(ch, binmin, binmax) + addduetoperiodicity) / c-&gt;integral(ch, 1, c-&gt;nbins());</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">float</span> channelIntegral = c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ich);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    fractionUnderPeak = channelIntegral &gt; 0 ? c-&gt;<a class="code" href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">integral</a>(ich, intmin, intmax) / channelIntegral : 0;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// now we need to store the results in the TimeSlewingObject</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#aa7c651da6f6e5fe8a5fa4b43788d6153">setFractionUnderPeak</a>(ich / <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>, ich % <a class="code" href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a>, fractionUnderPeak);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#a340c4b8fb43facc2f938bbb46aca75ca">setSigmaPeak</a>(ich / o2::tof::Geo::NPADSXSECTOR, ich % o2::tof::Geo::NPADSXSECTOR, abs(fitValues[2]));</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    ts.<a class="code" href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#acd835969d557e482e85fb2c58c490283">updateOffsetInfo</a>(ich, fitValues[1]);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keyword">auto</span> clName = <a class="code" href="../../d5/d71/structo2_1_1utils_1_1MemFileHelper.html#a27bc03604b90439a4dfb28c59dc01e91">o2::utils::MemFileHelper::getClassName</a>(ts);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keyword">auto</span> flName = <a class="code" href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0f9cdb198ea393fdad982b8452510ad5">o2::ccdb::CcdbApi::generateFileName</a>(clName);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  mInfoVector.emplace_back(<span class="stringliteral">&quot;TOF/ChannelCalib&quot;</span>, clName, flName, md, slot.<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">getTFStart</a>(), 99999999999999);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  mTimeSlewingVector.emplace_back(ts);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">//_____________________________________________</span></div><div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a48c811868bebc2ad592c14e695031a37">  511</a></span>&#160;<a class="code" href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">Slot</a>&amp; <a class="code" href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a48c811868bebc2ad592c14e695031a37">TOFChannelCalibrator::emplaceNewSlot</a>(<span class="keywordtype">bool</span> front, <a class="code" href="../../d6/d30/classuint64__t.html">TFType</a> tstart, <a class="code" href="../../d6/d30/classuint64__t.html">TFType</a> tend)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keyword">auto</span>&amp; cont = getSlots();</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keyword">auto</span>&amp; slot = front ? cont.emplace_front(tstart, tend) : cont.emplace_back(tstart, tend);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  slot.setContainer(std::make_unique&lt;TOFChannelData&gt;(mNBins, mRange, mCalibTOFapi));</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">return</span> slot;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;} <span class="comment">// end namespace tof</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;} <span class="comment">// end namespace o2</span></div><div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_ae6857148899e64edd5017e78eea7c0ca"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#ae6857148899e64edd5017e78eea7c0ca">o2::tof::TOFChannelData::merge</a></div><div class="ttdeci">void merge(const TOFChannelData *prev)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00056">TOFChannelCalibrator.cxx:56</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelCalibrator_html_ad76753b4f6bf5d2abca3cd895d069b4e"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#ad76753b4f6bf5d2abca3cd895d069b4e">o2::tof::TOFChannelCalibrator::finalizeSlot</a></div><div class="ttdeci">void finalizeSlot(Slot &amp;slot) final</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00427">TOFChannelCalibrator.cxx:427</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a1777d0fe702c095d9819568246bc63cf"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a1777d0fe702c095d9819568246bc63cf">o2::tof::TOFChannelData::getHisto</a></div><div class="ttdeci">boostHisto &amp; getHisto(int isect)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00079">TOFChannelCalibrator.h:79</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html_a340c4b8fb43facc2f938bbb46aca75ca"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#a340c4b8fb43facc2f938bbb46aca75ca">o2::dataformats::CalibTimeSlewingParamTOF::setSigmaPeak</a></div><div class="ttdeci">void setSigmaPeak(int sector, int channel, float value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d81/CalibTimeSlewingParamTOF_8h_source.html#l00070">CalibTimeSlewingParamTOF.h:70</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelCalibrator_html_a8b5f97f720904a0661302a57dfdb5ac6"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a8b5f97f720904a0661302a57dfdb5ac6">o2::tof::TOFChannelCalibrator::hasEnoughData</a></div><div class="ttdeci">bool hasEnoughData(const Slot &amp;slot) const final</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00415">TOFChannelCalibrator.cxx:415</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a870978c60ce50506bf2737d65ad20cda"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a870978c60ce50506bf2737d65ad20cda">o2::tof::TOFChannelData::findBin</a></div><div class="ttdeci">int findBin(float v) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00136">TOFChannelCalibrator.cxx:136</a></div></div>
<div class="ttc" id="namespaceo2_html"><div class="ttname"><a href="../../d4/d7c/namespaceo2.html">o2</a></div><div class="ttdoc">information complementary to a CCDB object (path, metadata, startTimeValidity, endTimeValidity etc) ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d24/BitstreamReader_8h_source.html#l00022">BitstreamReader.h:22</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a0c118737149aef562beb4d2d909b7856"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a0c118737149aef562beb4d2d909b7856">false</a></div><div class="ttdeci">false</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00016">qconfigoptions.h:16</a></div></div>
<div class="ttc" id="GPUCommonLogger_8h_html_aea3d0edfe28fc0325c636b2b33f0527a"><div class="ttname"><a href="../../df/d5b/GPUCommonLogger_8h.html#aea3d0edfe28fc0325c636b2b33f0527a">LOG</a></div><div class="ttdeci">#define LOG(type)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5b/GPUCommonLogger_8h_source.html#l00028">GPUCommonLogger.h:28</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a4568fc090febc136eed4577a600739ca"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a4568fc090febc136eed4577a600739ca">v</a></div><div class="ttdeci">const GLdouble * v</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00832">glcorearb.h:832</a></div></div>
<div class="ttc" id="classo2_1_1calibration_1_1TimeSlot_html_aeb4ac27a93d80114f40a046b1d213ee7"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#aeb4ac27a93d80114f40a046b1d213ee7">o2::calibration::TimeSlot::getTFStart</a></div><div class="ttdeci">TFType getTFStart() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00046">TimeSlot.h:46</a></div></div>
<div class="ttc" id="CcdbApi_8h_html"><div class="ttname"><a href="../../dd/d3e/CcdbApi_8h.html">CcdbApi.h</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a06add85eec10c887c41817a821735a5a"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a06add85eec10c887c41817a821735a5a">o2::tof::TOFChannelData::fill</a></div><div class="ttdeci">void fill(const gsl::span&lt; const o2::dataformats::CalibInfoTOF &gt; data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00038">TOFChannelCalibrator.cxx:38</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1CalibTOFapi_html_a07438f80c9ce46ef6adc737873574f00"><div class="ttname"><a href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a07438f80c9ce46ef6adc737873574f00">o2::tof::CalibTOFapi::getSlewParamObj</a></div><div class="ttdeci">SlewParam &amp; getSlewParamObj()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d65/CalibTOFapi_8h_source.html#l00060">CalibTOFapi.h:60</a></div></div>
<div class="ttc" id="TOFChannelCalibrator_8h_html"><div class="ttname"><a href="../../db/dc2/TOFChannelCalibrator_8h.html">TOFChannelCalibrator.h</a></div></div>
<div class="ttc" id="namespaceo2_1_1data__flow_html_a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873"><div class="ttname"><a href="../../d1/df4/namespaceo2_1_1data__flow.html#a3a67fd76d9a0e56c332aebc06a41e8e8ad6e1b2dd08ee0161c09b9dffb4f99873">o2::data_flow::ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db0/TimeframeParser_8cxx_source.html#l00049">TimeframeParser.cxx:49</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_ab8ab3733fc270083bb053f638332c733"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#ab8ab3733fc270083bb053f638332c733">o2::tof::Geo::NCHANNELS</a></div><div class="ttdeci">static constexpr int NCHANNELS</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00085">Geo.h:85</a></div></div>
<div class="ttc" id="classo2_1_1calibration_1_1TimeSlot_html_a6d93b6aefa753710338dc444293e2f69"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a6d93b6aefa753710338dc444293e2f69">o2::calibration::TimeSlot::getContainer</a></div><div class="ttdeci">const Container * getContainer() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00048">TimeSlot.h:48</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_aec9a4bf9c9cd1a976392f5ee9c0ef343"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#aec9a4bf9c9cd1a976392f5ee9c0ef343">o2::tof::TOFChannelData::hasEnoughData</a></div><div class="ttdeci">bool hasEnoughData(int minEntries) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00065">TOFChannelCalibrator.cxx:65</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a4e1bc930065ae1e1d544f84aaec652d8"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a4e1bc930065ae1e1d544f84aaec652d8">o2::tof::TOFChannelData::getRange</a></div><div class="ttdeci">float getRange() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00073">TOFChannelCalibrator.h:73</a></div></div>
<div class="ttc" id="MemFileHelper_8h_html"><div class="ttname"><a href="../../da/db7/MemFileHelper_8h.html">MemFileHelper.h</a></div></div>
<div class="ttc" id="classo2_1_1calibration_1_1TimeSlot_html_a1477ee455be0381a720a32610a5a87d7"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html#a1477ee455be0381a720a32610a5a87d7">o2::calibration::TimeSlot::getTFEnd</a></div><div class="ttdeci">TFType getTFEnd() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00047">TimeSlot.h:47</a></div></div>
<div class="ttc" id="namespaceo2_1_1math__utils_1_1math__base_html_a4d51272e915c57fb54bb05565cddbdc7"><div class="ttname"><a href="../../d6/db0/namespaceo2_1_1math__utils_1_1math__base.html#a4d51272e915c57fb54bb05565cddbdc7">o2::math_utils::math_base::fitGaus</a></div><div class="ttdeci">Double_t fitGaus(const size_t nBins, const T *arr, const T xMin, const T xMax, std::vector&lt; T &gt; &amp;param)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d72/MathBase_8h_source.html#l00143">MathBase.h:143</a></div></div>
<div class="ttc" id="qconfigoptions_8h_html_a0cef832a4f8154f4d66208d6d43cde29"><div class="ttname"><a href="../../d8/de9/qconfigoptions_8h.html#a0cef832a4f8154f4d66208d6d43cde29">int</a></div><div class="ttdeci">Visualize clusters only Timeframe settings Average distance in cm of events merged into Randomize distance around average distance of merged events int</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/de9/qconfigoptions_8h_source.html#l00025">qconfigoptions.h:25</a></div></div>
<div class="ttc" id="classo2_1_1ccdb_1_1CcdbApi_html_a0f9cdb198ea393fdad982b8452510ad5"><div class="ttname"><a href="../../d5/d47/classo2_1_1ccdb_1_1CcdbApi.html#a0f9cdb198ea393fdad982b8452510ad5">o2::ccdb::CcdbApi::generateFileName</a></div><div class="ttdeci">static std::string generateFileName(const std::string &amp;inp)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5f/CcdbApi_8cxx_source.html#l00384">CcdbApi.cxx:384</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a24a30678d517ad6e453258b9c3268b5f"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a24a30678d517ad6e453258b9c3268b5f">o2::tof::TOFChannelData::getEntriesPerChannel</a></div><div class="ttdeci">std::vector&lt; int &gt; getEntriesPerChannel() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00084">TOFChannelCalibrator.h:84</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html">o2::tof::TOFChannelData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00030">TOFChannelCalibrator.h:30</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1CalibTOFapi_html_a785c71a70e06703e36dd6d4d08581449"><div class="ttname"><a href="../../d9/d0d/classo2_1_1tof_1_1CalibTOFapi.html#a785c71a70e06703e36dd6d4d08581449">o2::tof::CalibTOFapi::getTimeCalibration</a></div><div class="ttdeci">float getTimeCalibration(int ich, float tot)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d35/CalibTOFapi_8cxx_source.html#l00090">CalibTOFapi.cxx:90</a></div></div>
<div class="ttc" id="MathBase_8h_html"><div class="ttname"><a href="../../df/d72/MathBase_8h.html">MathBase.h</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a614156c60d17bc95b9e04ea0f93a96f2"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a614156c60d17bc95b9e04ea0f93a96f2">o2::tof::TOFChannelData::integral</a></div><div class="ttdeci">float integral(int chmin, int chmax, float binmin, float binmax) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00154">TOFChannelCalibrator.cxx:154</a></div></div>
<div class="ttc" id="classo2_1_1calibration_1_1TimeSlot_html"><div class="ttname"><a href="../../d8/df5/classo2_1_1calibration_1_1TimeSlot.html">o2::calibration::TimeSlot</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/TimeSlot_8h_source.html#l00028">TimeSlot.h:28</a></div></div>
<div class="ttc" id="classuint64__t_html"><div class="ttname"><a href="../../d6/d30/classuint64__t.html">uint64_t</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html">o2::dataformats::CalibTimeSlewingParamTOF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d81/CalibTimeSlewingParamTOF_8h_source.html#l00025">CalibTimeSlewingParamTOF.h:25</a></div></div>
<div class="ttc" id="Logger_8h_html"><div class="ttname"><a href="../../dd/da4/Logger_8h.html">Logger.h</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_af539ee62d5961e7895bad7a627b20f89"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#af539ee62d5961e7895bad7a627b20f89">o2::tof::TOFChannelData::printEntries</a></div><div class="ttdeci">void printEntries() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00128">TOFChannelCalibrator.cxx:128</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a0cdec8e97a75ee9458b23d152bf962d4"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a></div><div class="ttdeci">GLint GLenum GLint x</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00403">glcorearb.h:403</a></div></div>
<div class="ttc" id="structo2_1_1utils_1_1MemFileHelper_html_a27bc03604b90439a4dfb28c59dc01e91"><div class="ttname"><a href="../../d5/d71/structo2_1_1utils_1_1MemFileHelper.html#a27bc03604b90439a4dfb28c59dc01e91">o2::utils::MemFileHelper::getClassName</a></div><div class="ttdeci">static std::string getClassName(const T &amp;obj)</div><div class="ttdoc">get the class name of the object </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db7/MemFileHelper_8h_source.html#l00037">MemFileHelper.h:37</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html_aa7c651da6f6e5fe8a5fa4b43788d6153"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#aa7c651da6f6e5fe8a5fa4b43788d6153">o2::dataformats::CalibTimeSlewingParamTOF::setFractionUnderPeak</a></div><div class="ttdeci">void setFractionUnderPeak(int sector, int channel, float value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d81/CalibTimeSlewingParamTOF_8h_source.html#l00069">CalibTimeSlewingParamTOF.h:69</a></div></div>
<div class="ttc" id="structo2_1_1calibration_1_1Utils_html"><div class="ttname"><a href="../../d1/d7c/structo2_1_1calibration_1_1Utils.html">o2::calibration::Utils</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de0/Detectors_2Calibration_2include_2DetectorsCalibration_2Utils_8h_source.html#l00030">Utils.h:30</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a744fbed01658cb96bb8ba7e85a86d1dc"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a744fbed01658cb96bb8ba7e85a86d1dc">distance</a></div><div class="ttdeci">GLsizei GLsizei GLfloat distance</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l05506">glcorearb.h:5506</a></div></div>
<div class="ttc" id="namespaceo2_1_1tof_html_a2c22977d7d687ce24d27d3bbbebd3848"><div class="ttname"><a href="../../d7/dae/namespaceo2_1_1tof.html#a2c22977d7d687ce24d27d3bbbebd3848">o2::tof::Slot</a></div><div class="ttdeci">o2::calibration::TimeSlot&lt; o2::tof::LHCClockDataHisto &gt; Slot</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dff/LHCClockCalibrator_8cxx_source.html#l00023">LHCClockCalibrator.cxx:23</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a91d2245fae116e7ebde1de0d43e9b062"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a91d2245fae116e7ebde1de0d43e9b062">o2::tof::TOFChannelData::print</a></div><div class="ttdeci">void print() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00082">TOFChannelCalibrator.cxx:82</a></div></div>
<div class="ttc" id="glcorearb_8h_html_a8922a680b00df660c57f47c1971d04c5"><div class="ttname"><a href="../../dc/da3/glcorearb_8h.html#a8922a680b00df660c57f47c1971d04c5">data</a></div><div class="ttdeci">GLboolean * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da3/glcorearb_8h_source.html#l00298">glcorearb.h:298</a></div></div>
<div class="ttc" id="GPUCommonAlgorithm_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dd/d0b/GPUCommonAlgorithm_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0b/GPUCommonAlgorithm_8h_source.html#l00385">GPUCommonAlgorithm.h:385</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelCalibrator_html_a48c811868bebc2ad592c14e695031a37"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a48c811868bebc2ad592c14e695031a37">o2::tof::TOFChannelCalibrator::emplaceNewSlot</a></div><div class="ttdeci">Slot &amp; emplaceNewSlot(bool front, TFType tstart, TFType tend) final</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00511">TOFChannelCalibrator.cxx:511</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelCalibrator_html_a206906f9633f12c46293a6848eedc664"><div class="ttname"><a href="../../dc/daf/classo2_1_1tof_1_1TOFChannelCalibrator.html#a206906f9633f12c46293a6848eedc664">o2::tof::TOFChannelCalibrator::initOutput</a></div><div class="ttdeci">void initOutput() final</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dff/TOFChannelCalibrator_8cxx_source.html#l00406">TOFChannelCalibrator.cxx:406</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a1b8f91c6018f30830cdb591dc84244bb"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a1b8f91c6018f30830cdb591dc84244bb">o2::tof::Geo::NSECTORS</a></div><div class="ttdeci">static constexpr Int_t NSECTORS</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00081">Geo.h:81</a></div></div>
<div class="ttc" id="classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF_html_acd835969d557e482e85fb2c58c490283"><div class="ttname"><a href="../../d2/dde/classo2_1_1dataformats_1_1CalibTimeSlewingParamTOF.html#acd835969d557e482e85fb2c58c490283">o2::dataformats::CalibTimeSlewingParamTOF::updateOffsetInfo</a></div><div class="ttdeci">bool updateOffsetInfo(int channel, float residualOffset)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d93/CalibTimeSlewingParamTOF_8cxx_source.html#l00118">CalibTimeSlewingParamTOF.cxx:118</a></div></div>
<div class="ttc" id="Detectors_2Calibration_2include_2DetectorsCalibration_2Utils_8h_html"><div class="ttname"><a href="../../d3/de0/Detectors_2Calibration_2include_2DetectorsCalibration_2Utils_8h.html">Utils.h</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1Geo_html_a926ba139cfed8d51e3f31a7fa840a25f"><div class="ttname"><a href="../../d7/d70/classo2_1_1tof_1_1Geo.html#a926ba139cfed8d51e3f31a7fa840a25f">o2::tof::Geo::NPADSXSECTOR</a></div><div class="ttdeci">static constexpr Int_t NPADSXSECTOR</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d54/Geo_8h_source.html#l00079">Geo.h:79</a></div></div>
<div class="ttc" id="classo2_1_1tof_1_1TOFChannelData_html_a274f94da58c355e71c0130ce3da3a538"><div class="ttname"><a href="../../d1/d07/classo2_1_1tof_1_1TOFChannelData.html#a274f94da58c355e71c0130ce3da3a538">o2::tof::TOFChannelData::getNbins</a></div><div class="ttdeci">int getNbins() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dc2/TOFChannelCalibrator_8h_source.html#l00076">TOFChannelCalibrator.h:76</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_051dca18e802f8e9474f2e30d29c04e0.html">Detectors</a></li><li class="navelem"><a class="el" href="../../dir_577c839d346a264df4e9e588ca2a45dd.html">TOF</a></li><li class="navelem"><a class="el" href="../../dir_7559d374f7e4089a12282edb4b89411f.html">calibration</a></li><li class="navelem"><a class="el" href="../../dir_433e21cb2528786b2d3a126cc8ab6bdb.html">src</a></li><li class="navelem"><a class="el" href="../../d9/dff/TOFChannelCalibrator_8cxx.html">TOFChannelCalibrator.cxx</a></li>
    <li class="footer">Generated on Mon Jun 29 2020 22:04:08 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
